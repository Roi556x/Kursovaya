<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Программа Клиента: Класс Client</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Программа Клиента
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Поиск','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Открытые члены</a> &#124;
<a href="#pub-attribs">Открытые атрибуты</a> &#124;
<a href="classClient-members.html">Полный список членов класса</a>  </div>
  <div class="headertitle">
<div class="title">Класс Client</div>  </div>
</div><!--header-->
<div class="contents">

<p>Класс в котором находятся переменные и функция для подключения клиента к серверу  
 <a href="classClient.html#details">Подробнее...</a></p>

<p><code>#include &lt;<a class="el" href="Client_8h_source.html">Client.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Открытые члены</h2></td></tr>
<tr class="memitem:ab183c5332141040713518bcf9a8547d8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classClient.html#ab183c5332141040713518bcf9a8547d8">connection</a> (string ip_adr, string portcon, string username, string password, string name_original_file, string name_result_file)</td></tr>
<tr class="memdesc:ab183c5332141040713518bcf9a8547d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">описания функции подключения клиента к серверу  <a href="classClient.html#ab183c5332141040713518bcf9a8547d8">Подробнее...</a><br /></td></tr>
<tr class="separator:ab183c5332141040713518bcf9a8547d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Открытые атрибуты</h2></td></tr>
<tr class="memitem:a6f4d0b4d4661a8885daba223243be691"><td class="memItemLeft" align="right" valign="top"><a id="a6f4d0b4d4661a8885daba223243be691"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>name_original_file</b></td></tr>
<tr class="separator:a6f4d0b4d4661a8885daba223243be691"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c5557510924cf3bb08b9107a1514a5d"><td class="memItemLeft" align="right" valign="top"><a id="a3c5557510924cf3bb08b9107a1514a5d"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>name_result_file</b></td></tr>
<tr class="separator:a3c5557510924cf3bb08b9107a1514a5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3f24aea7b5dbfc6b8eb98b1b13db012"><td class="memItemLeft" align="right" valign="top"><a id="ae3f24aea7b5dbfc6b8eb98b1b13db012"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>name_auto_file</b></td></tr>
<tr class="separator:ae3f24aea7b5dbfc6b8eb98b1b13db012"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf4f11ae80a7e8563bbdbac87b0687e8"><td class="memItemLeft" align="right" valign="top"><a id="aaf4f11ae80a7e8563bbdbac87b0687e8"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>username</b></td></tr>
<tr class="separator:aaf4f11ae80a7e8563bbdbac87b0687e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a051bc8c577ddabaa671c86c31894e0be"><td class="memItemLeft" align="right" valign="top"><a id="a051bc8c577ddabaa671c86c31894e0be"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>password</b></td></tr>
<tr class="separator:a051bc8c577ddabaa671c86c31894e0be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82572f08361ea3291f73e3625da987dd"><td class="memItemLeft" align="right" valign="top"><a id="a82572f08361ea3291f73e3625da987dd"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>ip_adr</b></td></tr>
<tr class="separator:a82572f08361ea3291f73e3625da987dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b01f2cd1423afb4074ce40e02a21677"><td class="memItemLeft" align="right" valign="top"><a id="a5b01f2cd1423afb4074ce40e02a21677"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>portcon</b></td></tr>
<tr class="separator:a5b01f2cd1423afb4074ce40e02a21677"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Подробное описание</h2>
<div class="textblock"><p>Класс в котором находятся переменные и функция для подключения клиента к серверу </p>
</div><h2 class="groupheader">Методы</h2>
<a id="ab183c5332141040713518bcf9a8547d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab183c5332141040713518bcf9a8547d8">&#9670;&nbsp;</a></span>connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Client::connection </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>ip_adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>portcon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>name_original_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>name_result_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>описания функции подключения клиента к серверу </p>
<p>подключение клиента к серверу и передача данных </p><dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramname">ip_adr</td><td>айпи по которому устанавливается соединение </td></tr>
    <tr><td class="paramname">portcon</td><td>порт по которому устанавливается соединение </td></tr>
    <tr><td class="paramname">username</td><td>логин клиента </td></tr>
    <tr><td class="paramname">password</td><td>пароль клиента </td></tr>
    <tr><td class="paramname">name_original_file</td><td>файл с векторами для передачи серверу на обработку </td></tr>
    <tr><td class="paramname">name_result_file</td><td>файл для записи результатов обработки и отправки сервера клиенту</td></tr>
  </table>
  </dd>
</dl>
<p>утсановка порта по умолчанию </p><div class="fragment"><div class="line">*<span class="keywordflow">if</span>(portcon == <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line">     portcon = <span class="stringliteral">&quot;33333&quot;</span>;</div>
<div class="line"> }</div>
</div><!-- fragment --><p> Инициализация айпи </p><div class="fragment"><div class="line">*<span class="keywordtype">char</span>* ip_chars = <span class="keyword">new</span> <span class="keywordtype">char</span>[ip_adr.length()];</div>
<div class="line">*ip_adr.copy(ip_chars, ip_adr.length());</div>
<div class="line">*ip_chars[ip_adr.length()] = <span class="charliteral">&#39;\0&#39;</span>;</div>
</div><!-- fragment --><p> Инициализируем переменную для порта </p><div class="fragment"><div class="line">*<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> portik;</div>
<div class="line">*portik = stoi(portcon);</div>
</div><!-- fragment --><p> Создаём структуру с введённым адресом и портом </p><div class="fragment"><div class="line">*sockaddr_in * selfAddr = <span class="keyword">new</span> (sockaddr_in);</div>
<div class="line">*selfAddr-&gt;sin_family = AF_INET; <span class="comment">// интернет протокол IPv4</span></div>
<div class="line">*selfAddr-&gt;sin_port = 0;</div>
<div class="line">*selfAddr-&gt;sin_addr.s_addr = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">*sockaddr_in * remoteAddr = <span class="keyword">new</span> (sockaddr_in);</div>
<div class="line">*remoteAddr-&gt;sin_family = AF_INET;     <span class="comment">// интернет протокол IPv4</span></div>
<div class="line">*remoteAddr-&gt;sin_port = htons(portik);</div>
<div class="line">*remoteAddr-&gt;sin_addr.s_addr = inet_addr(ip_chars); <span class="comment">//  адрес</span></div>
</div><!-- fragment --><p> буфер для передачи и приема данных </p><div class="fragment"><div class="line">*<span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[4096];</div>
<div class="line">*strcpy(buffer,username.c_str());</div>
</div><!-- fragment --><p> вычисляем длину строки </p><div class="fragment"><div class="line">*<span class="keywordtype">int</span> msgLen = strlen(buffer);      </div>
</div><!-- fragment --><p>создаём сокет </p><div class="fragment"><div class="line">*<span class="keywordtype">int</span> mySocket = socket(AF_INET, SOCK_STREAM, 0); <span class="comment">//tcp протокол</span></div>
</div><!-- fragment --><p>связываем сокет с адрессом </p><div class="fragment"><div class="line">*<span class="keywordtype">int</span> rc = bind(mySocket,(<span class="keyword">const</span> sockaddr *) selfAddr, <span class="keyword">sizeof</span>(sockaddr_in));</div>
</div><!-- fragment --><p>установливаем соединение </p><div class="fragment"><div class="line">*rc = connect(mySocket, (<span class="keyword">const</span> sockaddr*) remoteAddr, <span class="keyword">sizeof</span>(sockaddr_in));</div>
</div><!-- fragment --><p>Проверка соединения клиента с сервером </p><div class="fragment"><div class="line">*<span class="keywordflow">if</span> (rc == -1) {</div>
<div class="line">*cout &lt;&lt; <span class="stringliteral">&quot;Error: failed connect to server.\n&quot;</span>;</div>
<div class="line">*close(mySocket);</div>
<div class="line">*<span class="keywordflow">return</span> 1;</div>
<div class="line"> }</div>
<div class="line">*<span class="keywordflow">else</span> cout&lt;&lt;<span class="stringliteral">&quot;Connection is succesful&quot;</span>&lt;&lt;endl;</div>
</div><!-- fragment --><p> Отправка логина серверу </p><div class="fragment"><div class="line">*rc = send(mySocket, buffer, msgLen, 0);</div>
<div class="line">*<span class="keywordflow">if</span>(rc==-1)</div>
<div class="line"> {</div>
<div class="line">      <span class="keywordflow">throw</span> <a class="code" href="classerror__client.html">error_client</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Ошибка отправки логина&quot;</span>));</div>
<div class="line"> }</div>
<div class="line">*cout &lt;&lt; <span class="stringliteral">&quot;Мы отправляем логин: &quot;</span> &lt;&lt; buffer &lt;&lt; endl;</div>
<div class="ttc" id="aclasserror__client_html"><div class="ttname"><a href="classerror__client.html">error_client</a></div><div class="ttdoc">Класс для обработки ошибок возникающих при работе клиента</div><div class="ttdef"><b>Definition:</b> Client.h:36</div></div>
</div><!-- fragment --><p>принимаем ответ в буффер </p><div class="fragment"><div class="line">*rc = recv(mySocket, buffer, 4096, 0);</div>
<div class="line">*<span class="keywordflow">if</span>(rc==-1)</div>
<div class="line"> {</div>
<div class="line">      <span class="keywordflow">throw</span> <a class="code" href="classerror__client.html">error_client</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Ошибка получения ответа&quot;</span>));</div>
<div class="line"> }</div>
<div class="line">*<span class="keywordtype">string</span> s1 = string(buffer);</div>
<div class="line">*buffer[rc] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">// конец принятой строки</span></div>
<div class="line"> </div>
<div class="line">*cout &lt;&lt; <span class="stringliteral">&quot;Мы получаем соль: &quot;</span> &lt;&lt; buffer &lt;&lt; endl; <span class="comment">// вывод полученного сообщения от сервера</span></div>
</div><!-- fragment --><p>Далее генерируется хэш и отправляется серверу </p><div class="fragment"><div class="line">*<span class="keywordtype">string</span> s2;</div>
<div class="line">*<span class="keywordtype">string</span> msg = s1 + password;</div>
<div class="line">*s2 = MD5_hash(msg);</div>
<div class="line"> </div>
<div class="line">*strcpy(buffer,s2.c_str());</div>
<div class="line">*rc = send(mySocket, buffer, s2.length(), 0);</div>
<div class="line">*cout &lt;&lt; <span class="stringliteral">&quot;Мы отправляем хэш: &quot;</span> &lt;&lt; buffer &lt;&lt; endl;</div>
</div><!-- fragment --><p>Получене ответа об аутентификации </p><div class="fragment"><div class="line">*rc = recv(mySocket, buffer, <span class="keyword">sizeof</span>(buffer), 0);</div>
<div class="line">*buffer[rc] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">// конец принятой строки</span></div>
<div class="line">*<span class="keywordflow">if</span>(rc==-1)</div>
<div class="line"> {</div>
<div class="line">      <span class="keywordflow">throw</span> <a class="code" href="classerror__client.html">error_client</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Ошибка получения ответа&quot;</span>));</div>
<div class="line"> }</div>
<div class="line">*cout &lt;&lt; <span class="stringliteral">&quot;Мы получаем ответ: &quot;</span> &lt;&lt; buffer &lt;&lt; endl; <span class="comment">// вывод полученного сообщения от сервера</span></div>
</div><!-- fragment --><p> Открытие файла для записи результата </p><div class="fragment"><div class="line">*ofstream fout(name_result_file, ios::binary | ios::out | ios::app);</div>
<div class="line">*<span class="keywordflow">if</span>(!fout)</div>
<div class="line"> {</div>
<div class="line">     <span class="keywordflow">throw</span> <a class="code" href="classerror__client.html">error_client</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Ошибка открытия файла&quot;</span>));</div>
<div class="line"> }</div>
<div class="line">*endcode</div>
<div class="line">  Далее открывается файл с векторами для отправки</div>
<div class="line">  @code</div>
<div class="line">*uint32_t n;</div>
<div class="line">*FILE *f; <span class="comment">//описываем файловую переменную</span></div>
<div class="line">*<span class="keyword">const</span> <span class="keywordtype">char</span> * c = name_original_file.c_str(); <span class="comment">//конвертируем строку с названием файла с векторами в const char *</span></div>
<div class="line">*f=fopen(c, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line">*<span class="keywordflow">if</span>(f==NULL)</div>
<div class="line">     {</div>
<div class="line">         <span class="keywordflow">throw</span> <a class="code" href="classerror__client.html">error_client</a>(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Ошибка открытия файла&quot;</span>));</div>
<div class="line">    }</div>
<div class="line">  endcode</div>
<div class="line">*считываем из файла одyо целое число в переменную n которое является количеством векторов</div>
<div class="line">  @code</div>
<div class="line">*fread(&amp;n, <span class="keyword">sizeof</span>(uint32_t), 1, f);</div>
</div><!-- fragment --><p>отправка количества векторов на сервер </p><div class="fragment"><div class="line">*rc = send(mySocket, &amp;n, <span class="keyword">sizeof</span>(n), 0);</div>
</div><!-- fragment --><p> cout &lt;&lt; "Мы отправляем кол-во векторов: " &lt;&lt; n &lt;&lt; endl; // вывод полученного сообщения от сервера fout&lt;&lt;n&lt;&lt;endl; далее идёт отправка количество чисел, содержащиеся в векторе </p><div class="fragment"><div class="line">*<span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;n; i++)</div>
<div class="line"> {</div>
<div class="line">*uint32_t size;</div>
<div class="line">*<span class="keywordtype">double</span> d;</div>
<div class="line">     fread(&amp;size, <span class="keyword">sizeof</span>(uint32_t), 1, f);</div>
<div class="line">     uint32_t size1;</div>
<div class="line">     size1=(4+size*<span class="keyword">sizeof</span>(size));</div>
<div class="line">     cout&lt;&lt;<span class="stringliteral">&quot;Размер  &quot;</span>&lt;&lt;i+1&lt;&lt;<span class="stringliteral">&quot;-го  вектора  &quot;</span>&lt;&lt;size1&lt;&lt;<span class="stringliteral">&quot; байт&quot;</span>&lt;&lt;endl;</div>
<div class="line">     send(mySocket, &amp;size, <span class="keyword">sizeof</span>(size), 0);<span class="comment">//отправка размера вектора</span></div>
</div><!-- fragment --><p> далее отправляются сами векторы массивом на сервер </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> array[size]={0};</div>
<div class="line">cout&lt;&lt;<span class="stringliteral">&quot;Векторы в строке  &quot;</span>;</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;size;j++)</div>
<div class="line">{</div>
<div class="line">    fread(&amp;d, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), 1, f);</div>
<div class="line">    array[j]=d;                 <span class="comment">//заполнение вектора в массив</span></div>
<div class="line">    cout&lt;&lt;d&lt;&lt;<span class="stringliteral">&quot;   &quot;</span>;     <span class="comment">//вывод вектора в строке</span></div>
<div class="line">}</div>
<div class="line">cout&lt;&lt;endl;</div>
<div class="line">send(mySocket, &amp;array, <span class="keyword">sizeof</span>(array), 0);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Мы отправляем сам вектор: &quot;</span> &lt;&lt; array &lt;&lt; endl; <span class="comment">// вывод полученного сообщения от сервера</span></div>
<div class="line"><span class="keywordtype">double</span> sum = 0;</div>
<div class="line">recv(mySocket, &amp;sum, <span class="keyword">sizeof</span>(sum), 0);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Мы получаем ответ: &quot;</span> &lt;&lt; sum &lt;&lt; endl; <span class="comment">// вывод полученного сообщения от сервера</span></div>
<div class="line">fout &lt;&lt;sum&lt;&lt; endl;</div>
</div><!-- fragment --><p> } После обмена файлами закрываются сокет и файлы </p><div class="fragment"><div class="line">*close(mySocket);</div>
<div class="line">  fout.close();</div>
</div><!-- fragment --> <p>return 0;</p>

</div>
</div>
<hr/>Объявления и описания членов классов находятся в файлах:<ul>
<li><a class="el" href="Client_8h_source.html">Client.h</a></li>
<li><a class="el" href="Client_8cpp.html">Client.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Создано системой&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
